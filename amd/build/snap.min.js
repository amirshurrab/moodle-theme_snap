define(["jquery","theme_snap/bootstrap","core/log","theme_snap/headroom","theme_snap/util","theme_snap/personal_menu","theme_snap/responsive_video","theme_snap/cover_image"],function(a,b,c,d,e,f,g,h){"use strict";a=b,M.theme_snap=M.theme_snap||{};var i=!1;i?c.enableAll(!0):c.disableAll(!0);var j=function(a){var b=a.split("?");if(b.length<2)return!1;var c=b[1];c=c.split("#")[0];for(var d=c.split("&"),e=[],f=0;f<d.length;f++){var g=d[f].split("="),h=g[0],i=g[1];e[h]=i}return e},k=function(){var b=a(".xdebug-error");if(b.length)for(var c=0;c<b.length;c++){var d=b[c],e=d.parentNode,f=a(e).prev("br");a(f).remove()}var g=a(".xdebug-error, .php-debug, .debuggingmessage");if(g.length){a(g).addClass("php-debug-footer");var h=a('<div id="footer-error-cont"><h3>'+M.util.get_string("debugerrors","theme_snap")+"</h3><hr></div>");a("#page-footer").append(h),a("#footer-error-cont").append(g),a(".php-debug-footer").after(a("<hr>")),a("#mr-nav").addClass("errors-found");var i=a('<a class="footer-error-link btn btn-danger" href="#footer-error-cont">'+M.util.get_string("problemsfound","theme_snap")+' <span class="badge">'+g.length+"</span></a>");a("#page-header").append(i)}},l=function(){return 0===a("body").attr("id").indexOf("page-course-view-")},m=function(){if(l()&&a(".block_adminblock form").each(function(){a(this).attr("action",a(this).attr("action")+"#coursetools")}),""===location.hash){var b=j(location.href);l()&&"undefined"!=typeof b.time&&(location.hash="coursetools",a(".block_calendar_month")&&e.scrollToElement(a(".block_calendar_month")));var c=["body.path-blocks-collect #notice form"],d=["bui_deleteid","bui_editid"];for(var f in d){var g=d[f];if("undefined"!=typeof b[g]){c.push("#notice form");break}}a(c.join(", ")).each(function(){var b=a(this).attr("action");b.indexOf("#")===-1&&b.indexOf("/course/view.php")>-1&&a(this).attr("action",a(this).attr("action")+"#coursetools")})}},n=function(){a(".path-mod-forum tr.discussion td.topic.starter").attr("data-cellname",M.util.get_string("forumtopic","theme_snap")),a(".path-mod-forum tr.discussion td.picture:not('.group')").attr("data-cellname",M.util.get_string("forumauthor","theme_snap")),a(".path-mod-forum tr.discussion td.picture.group").attr("data-cellname",M.util.get_string("forumpicturegroup","theme_snap")),a(".path-mod-forum tr.discussion td.replies").attr("data-cellname",M.util.get_string("forumreplies","theme_snap")),a(".path-mod-forum tr.discussion td.lastpost").attr("data-cellname",M.util.get_string("forumlastpost","theme_snap"))},o=function(a){return a=a.trim().toLowerCase()},p=function(b){var c,d=window.navigator.userAgent;(d.indexOf("MSIE ")||d.indexOf("Trident/"))&&(b=a("#toc-searchables").find("li").clone(!0));var e=a("#toc-search-input").val();if(e=o(e),0===e.length)a("#toc-search-results").html(""),a("#toc-search-input").removeClass("state-active");else{a("#toc-search-input").addClass("state-active");var f=[];for(c=0;c<b.length;c++){var g=b[c];o(a(g).text()).indexOf(e)>-1&&f.push(g)}a("#toc-search-results").html(f)}},q=function(){var b=[];a("#notice.snap-continue-cancel").length&&b.push("hascontinuecancel"),a("body").addClass(b.join(" "))},r=function(b){var d=location.hash;a(window).on("popstate hashchange",function(e){var g=location.hash;c.info("hashchange"),g!==d&&("#primary-nav"===location.hash?f.update():(a("#page, #moodle-footer, #js-personal-menu-trigger, #logo, .skiplinks").css("display",""),l()&&(c.info("show section",e.target),b.showSection()))),d=g})},s=function(){var b=[".chapters a",".section_footer a"," #toc-search-results a"];a(document).on("click",b.join(", "),function(b){var c=this.getAttribute("href");window.history&&window.history.pushState?(history.pushState(null,null,c),a(window).trigger("hashchange"),b.preventDefault()):location.hash=c});var c=document.querySelector("#mr-nav"),f=new d(c,{tolerance:5,offset:100,classes:{initial:"headroom",pinned:"headroom--pinned",unpinned:"headroom--unpinned",top:"headroom--top",notTop:"headroom--not-top"}});a(".notloggedin").length||f.init();var g=a("#toc-searchables").find("li").clone(!0);a("#course-toc").on("keyup","#toc-search-input",function(){p(g)}),a("#course-toc").on("keydown","#toc-search-input",function(b){var c=b.keyCode||b.which;9===c&&a("#toc-search-results a").last().blur(function(){a(this).off("blur"),a("#toc-search-input").val(""),a("#toc-search-results").html(""),a("#toc-search-input").removeClass("state-active")})}),a("#course-toc").on("click","#toc-search-results a",function(){a("#toc-search-input").val(""),a("#toc-search-results").html(""),a("#toc-search-input").removeClass("state-active")}),a(document).on("click",function(b){a(b.target).closest("#toc-search-input").length||(a("#toc-search-input").val(""),a("#toc-search-results").html(""),a("#toc-search-input").removeClass("state-active"))}),a(document).on("click","#admin-menu-trigger, #toc-mobile-menu-toggle",function(b){var c=this.getAttribute("href");"admin-menu-trigger"==this.getAttribute("id")&&(a(this).toggleClass("active"),a("#page").toggleClass("offcanvas")),a(c).attr("tabindex","0"),a(c).toggleClass("state-visible").focus(),b.preventDefault()}),a(document).on("click","#course-toc.state-visible a",function(){a("#course-toc").removeClass("state-visible")}),a(document).on("click",".news-article .toggle",function(b){var c=a(this).closest(".news-article");e.scrollToElement(c),a(".news-article").not(c).removeClass("state-expanded"),a(".news-article-message").css("display","none"),c.toggleClass("state-expanded"),a(".state-expanded").find(".news-article-message").slideDown("fast",function(){c.is(".state-expanded")?(c.find(".news-article-message").focus(),c.attr("aria-expanded","true")):(c.focus(),c.attr("aria-expanded","false")),a(document).trigger("snapContentRevealed")}),b.preventDefault()}),a(function(){var b=!1;"ontouchstart"in window?b=!0:window.navigator.msPointerEnabled&&(b=!0),b||a('[data-toggle="tooltip"]').tooltip()})};return{snapInit:function(b,c,d,e){M.cfg.context=b.contextid,M.snapTheme={forcePassChange:e},f.init(),c&&require(["theme_snap/course-lazy"],function(a){var c=new a(b);r(c)}),a(document).ready(function(){if(k(),n(),s(),m(),q(),h(b.shortname,d),a("body").hasClass("snap-fixy-open")&&f.update(),a("#page-course-editsection.format-topics").length){var c=document.getElementById("id_usedefaultname"),e=document.getElementById("id_name");c.value="0",c.checked=!1,e.required="required",e.focus(),a("#id_name + span").css("display","none"),a("#id_cancel").on("click",function(){a("#id_name").removeAttr("required"),a("#mform1").submit()})}if(a("#page-mod-book-view").length){var i=j(location.href);a(".block_book_toc").append('<p><hr><a target="_blank" href="/mod/book/tool/print/index.php?id='+i.id+'">'+M.util.get_string("printbook","booktool_print")+"</a></p>")}var l=/^page-mod-.*-mod$/,o=l.test(a("body").attr("id"))&&location.href.indexOf("modedit")>-1,p="page-course-edit"===a("body").attr("id"),r="page-course-editsection"===a("body").attr("id"),t=["page-mod-hvp-mod"],u=t.indexOf(a("body").attr("id"))===-1;if((o||p||r)&&u){var v=[":first","#page-course-edit #id_descriptionhdr","#id_contentsection","#id_general + #id_general","#id_content","#page-mod-choice-mod #id_optionhdr","#page-mod-assign-mod #id_availability","#page-mod-assign-mod #id_submissiontypes","#page-mod-workshop-mod #id_gradingsettings","#page-mod-choicegroup-mod #id_miscellaneoussettingshdr","#page-mod-choicegroup-mod #id_groups","#page-mod-scorm-mod #id_packagehdr"];v=v.join(),a("#mform1 > fieldset").not(v).wrapAll('<div class="snap-form-advanced col-md-4" />'),a(".snap-form-advanced").append(a(".collapsible-actions"));for(var w=a("#mform1 fieldset:first"),x=a("#mform1 fieldset:first .fcontainer"),y=a("#mform1 > fieldset").not("#mform1 > fieldset:first"),z=0;z<y.length;z++){var A=a(y[z]).find(".fcontainer");a(x).append(A),a(y[z]).remove()}a(w).wrap('<div class="snap-form-required col-md-8" />');var B=a("#mform1 fieldset:first .fitem_feditor:not(.required)");if(o&&B){var C="page-mod-assign-mod"==a("body").attr("id"),D="page-mod-choice-mod"==a("body").attr("id"),E="page-mod-turnitintool-mod"==a("body").attr("id"),F="page-mod-workshop-mod"==a("body").attr("id");D||C||E||F||(a(x).append(B),a(x).append(a("#fitem_id_showdescription")))}var G=a("#mform1 #fgroup_id_buttonar");a(w).append(G)}g.init(),a(window).on("load",function(){a("body").addClass("snap-js-loaded")})})}}});