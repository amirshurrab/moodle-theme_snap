define(["jquery","core/ajax","core/notification","theme_snap/model_view","core/log"],function(a,b,c,d,e){return function(f){e.enableAll(!0);var g=function(b,c){d(c,"theme_snap/course_cards");var e=function(){var b=a(c).find(".favoritetoggle");a(b).removeClass("ajaxing"),a(b).focus()};a(c).trigger("modelUpdate",[b,e])},h=function(b){return parseInt(a(b).find(".courseinfo-body").data("courseid"))},i=function(b,c){c=!0;var d=a(b).find(".coursefullname").html();return c&&(d=d.toLowerCase()),d},j=function(a,b){if(0===b.length)return-1;var c=[],d={};return b.each(function(){d={title:i(this),card:this},c.push(d)}),d={title:i(a),card:a},c.push(d),c.sort(function(a,b){var c=h(a.card),d=h(b.card);return a.title===b.title?c===d?0:c>d?1:-1:a.title>b.title?1:-1}),c.indexOf(d)},k=function(b,c,d,g,h){var i=a(c),k=j(b,i),l=k+1;e.debug("Moving card element into position "+l+" of list (size = "+i.length+") : "+c),l>0?l<=i.length?(e.debug("Moving card before position "+l+"  using selector "+c),a(c).eq(k).before(b)):(e.debug("Moving card after position "+i.length+" using selector "+c),a(c).eq(i.length-1).after(b)):(e.debug("Destination "+c+" empty"),g?(e.debug("prepending to "+d),a(d).prepend(b)):(e.debug("appending to "+d),a(d).append(b))),f.updateToggleCount(),"function"==typeof h&&h()},l=function(b,c){var d;a(b).data("hidden")===!0?(d="#fixy-hidden-courses",a(".header-hidden-courses").addClass("state-visible"),a("#fixy-hidden-courses").is(":visible")||f.toggleHidden(!1)):d="#fixy-visible-courses",k(b,d+" .courseinfo:not(.favorited)",d,!1,c)},m=function(d){if(!a(d).hasClass("ajaxing")){a(d).addClass("ajaxing");var e="true"===a(d).attr("aria-pressed")?0:1,f=a(a(d).parents(".courseinfo")[0]),h=a(f).data("shortname"),i=function(){b.call([{methodname:"theme_snap_course_card",args:{courseshortname:h,favorited:e},done:function(a){g(a,f)},fail:function(b){a(d).removeClass("ajaxing"),c.exception(b)}}],!0,!0)};1===e?k(f,"#fixy-visible-courses .courseinfo.favorited","#fixy-visible-courses",!0,i):l(f,i)}};a("#fixy-my-courses").on("click",".favoritetoggle",function(a){a.preventDefault(),a.stopPropagation(),m(this)})}});