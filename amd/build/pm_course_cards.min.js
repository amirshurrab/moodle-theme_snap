define(["jquery","core/log","theme_snap/pm_course_cards_hidden","theme_snap/pm_course_favorites","theme_snap/model_view"],function(a,b,c,d,e){var f=function(){a(document).ready(function(){d(c);var f=!0;if("object"==typeof localStorage)try{localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage")}catch(g){f=!1}var h=[],i=M.cfg.sesskey+"courseinfo";if(a(".courseinfo").each(function(){h.push(a(this).attr("data-courseid"))}),h.length>0){var j=function(c){for(var d in c){var f=c[d];b.debug("applying course data for courseid "+f.course);var g=a('.courseinfo[data-courseid="'+f.course+'"]');e(g,"theme_snap/course_cards"),a(g).trigger("modelUpdate",f)}};if(window.sessionStorage[i]){var k=JSON.parse(window.sessionStorage[i]);j(k)}var l="courseids="+h.join(",");b.debug("fetching course data"),a.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_courseinfo&contextid="+M.cfg.context,data:l,success:function(a){a.info?(b.debug("fetched coursedata",a.info),f&&(window.sessionStorage[i]=JSON.stringify(a.info)),j(a.info)):b.warn("fetched coursedata with error: JSON data object is missing info property",a)}})}}),a("#fixy-my-courses").on("click hover",".courseinfo-teachers-more",null,function(b){b.preventDefault();var c=a(this).html();c.indexOf("+")>-1?a(this).html(c.replace("+","-")):a(this).html(c.replace("-","+")),a(this).parents(".courseinfo").toggleClass("show-all")}),a(document).on("click",".courseinfo[data-href]",function(b){var c=a(b.target),d="_self";a(c).closest("a").length||(window.open(a(this).data("href"),d),b.preventDefault())})};return new f});